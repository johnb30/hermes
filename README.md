# Hermes 
![Logo](http://en.wikipedia.org/wiki/File:FuturamaHermesConrad.png#/media/File:FuturamaHermesConrad.png)

## Services

Hermes is a RESTful API wrapper for a number of text processing
services, allowing for the quick generation of text features. We've tried to
make it as easy as possible to deploy the service on your own system by
containerizing each piece with [Docker](https://www.docker.com/whatisdocker/) (i.e. text
features in a box). The following services are currently implemented:

- **MITIE:** [MIT Infromation Extraction](https://github.com/mit-nlp/MITIE)
- **CLIFF:** [Server](https://github.com/c4fcm/CLIFF) for
    [CLAVIN](https://github.com/Berico-Technologies/CLAVIN/tree/stable/1.1.x).
    Andy Halterman has an image for running CLIFF over on [Docker
    Hub](https://registry.hub.docker.com/u/ahalterman/cliff/)
- **Topic Model:** LDA model with 50 topics, implemented in
    [gensim](https://radimrehurek.com/gensim/)

## Fields

Hermes returns the following fields from each service

- **MITIE**
    - entities
        - entity_text: the actual text pulled from the string (Ex: Syria)
        - tag: the MITIE tag for the entity text (Ex: LOCATION)
        - start: the start of the entity location in the string (Ex: 6)
        - stop: the end of the entity location in the string (Ex: 7)
        - score: the MITIE confidence score (Ex: 1.1885840007455295)
    - html: HTML generated for highlighting entities in dashboards, etc.
    - cleaned_tokens: tokenized words generated by the MITIE container.
        For use as a bag of words.
- **CLIFF**
    - This is the unformatted return from CLIFF, just like if you were running
        it as a standalone. It has a lot of fields, most of which are self
        explanatory.
- **Topic Model**
    - topics:

## Running

Make sure you have docker installed first. Instructions for Ubuntu can be found
[here](http://docs.docker.com/installation/ubuntulinux/) and for OS X (via
boot2docker) [here](https://docs.docker.com/installation/mac/). Hermes requires
docker-compose, which you can install via `sudo pip install -U docker-compose`.
If you're on OS X be sure to set your environment variable correctly using:
`(boot2docker shellinit)`.

Then its as simple as `sudo docker-compose up`. You can pass it the `-d` flag
to run it in the background. To test if the api is working you can use cURL:

```bash
curl -i -u user:text2features -H "Content-Type: application/json" -d
'{"content": "Insurgents bombarded a government-held part of Syria'"'"'s second
city Aleppo overnight, killing at least eight people, Syrian state media
reported. The Syrian Observatory for Human Rights, a UK-based group that tracks the war,
said eight people were killed in an air strike by government forces in a
separate, rebel-held part of the city."}' -X POST http://localhost:5000/
```

If you are on OS X, swap out `localhost` for whatever your boot2docker IP
address is. You can find it by running `boot2docker ip`.

The response should look like this:

```http
HTTP/1.1 201 CREATED
Content-Type: application/json
Content-Length: 3238
Server: TornadoServer/4.1

{
  "MITIE": {
    "entities": "[{\"start\": 6, \"entity_text\": \"Syria\", \"tag\": \"LOCATION\", \"stop\": 7, \"score\": 1.1885840007455295}, {\"start\": 10, \"entity_text\": \"Aleppo\", \"tag\": \"LOCATION\", \"stop\": 11, \"score\": 0.6466367651771303}, {\"start\": 19, \"entity_text\": \"Syrian\", \"tag\": \"MISC\", \"stop\": 20, \"score\": 1.1922037730890405}, {\"start\": 28, \"entity_text\": \"Human Rights\", \"tag\": \"ORGANIZATION\", \"stop\": 30, \"score\": 0.6246598122395554}, {\"start\": 32, \"entity_text\": \"UK-based\", \"tag\": \"MISC\", \"stop\": 33, \"score\": 1.3681621776612611}]",
    "html": "\"Insurgents bombarded a government-held part of Syria 's second city Aleppo overnight , killing at least eight people , Syrian state media reported . The Syrian Observatory for <span class=\\\"mitie-ORGANIZATION\\\">Human Rights<\/span> , a UK-based group that tracks the war , said eight people were killed in an air strike by government forces in a separate , rebel-held part of the city .\"",
    "cleaned_tokens": "[\"insurgents\", \"bombarded\", \"governmentheld\", \"part\", \"syria\", \"second\", \"city\", \"aleppo\", \"overnight\", \"killing\", \"least\", \"eight\", \"people\", \"syrian\", \"state\", \"media\", \"reported\", \"syrian\", \"observatory\", \"human\", \"rights\", \"ukbased\", \"group\", \"tracks\", \"war\", \"said\", \"eight\", \"people\", \"were\", \"killed\", \"air\", \"strike\", \"government\", \"forces\", \"separate\", \"rebelheld\", \"part\", \"city\"]"
  },
  \"topics\": [[3, 0.034243634377867184], [13, 0.46910971927177875], [16, 0.19956133562897088], [37, 0.17131373271406039], [38, 0.1020873674810064]], \"highest_topic_string\": \"Control\", \"highest_topic_index\": 13, \"topic_strings\": [[\"Assad\", 0.034243634377867184], [\"Control\", 0.46910971927177875], [\"Cities\", 0.19956133562897088], [\"Rebels\", 0.17131373271406039], [\"Kobani\", 0.1020873674810064]],
  "CLIFF": {
    "status": "ok",
    "version": "2.0.0",
    "results": {
      "organizations": [
        {
          "count": 1,
          "name": "Syrian Observatory for Human Rights"
        }
      ],
      "places": {
        "mentions": [
          {
            "confidence": 1,
            "name": "Syrian Arab Republic",
            "countryCode": "SY",
            "featureCode": "PCLI",
            "lon": 38,
            "source": {
              "charIndex": 47,
              "string": "Syria"
            },
            "stateCode": "00",
            "featureClass": "A",
            "lat": 35,
            "id": 163843,
            "population": 22198110
          },
          {
            "confidence": 1,
            "name": "Aleppo",
            "countryCode": "SY",
            "featureCode": "PPLA",
            "lon": 37.16117,
            "source": {
              "charIndex": 67,
              "string": "Aleppo"
            },
            "stateCode": "09",
            "featureClass": "P",
            "lat": 36.20124,
            "id": 170063,
            "population": 1602264
          }
        ],
        "focus": {
          "states": [
            {
              "name": "Aleppo Governorate",
              "countryCode": "SY",
              "featureCode": "ADM1",
              "lon": 37.61667,
              "score": 1,
              "stateCode": "09",
              "featureClass": "A",
              "lat": 36.25,
              "id": 170062,
              "population": 3115559
            }
          ],
          "cities": [
            {
              "name": "Aleppo",
              "countryCode": "SY",
              "featureCode": "PPLA",
              "lon": 37.16117,
              "score": 1,
              "stateCode": "09",
              "featureClass": "P",
              "lat": 36.20124,
              "id": 170063,
              "population": 1602264
            }
          ],
          "countries": [
            {
              "name": "Syrian Arab Republic",
              "countryCode": "SY",
              "featureCode": "PCLI",
              "lon": 38,
              "score": 2,
              "stateCode": "00",
              "featureClass": "A",
              "lat": 35,
              "id": 163843,
              "population": 22198110
            }
          ]
        }
      },
      "people": [
        
      ]
    },
    "milliseconds": 38
  }
}
```
